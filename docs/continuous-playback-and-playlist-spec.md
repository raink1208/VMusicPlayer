# é€£ç¶šå†ç”Ÿãƒ»ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿæ©Ÿèƒ½ ä»•æ§˜æ›¸

**ä½œæˆæ—¥**: 2026-01-27  
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: VMusicPlayer  
**æ©Ÿèƒ½**: é€£ç¶šå†ç”Ÿã€å†ç”Ÿã‚­ãƒ¥ãƒ¼ã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç®¡ç†

---

## ğŸ“‹ æ¦‚è¦

VMusicPlayerã«é€£ç¶šå†ç”Ÿæ©Ÿèƒ½ã¨ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ã—ã€ã‚ˆã‚Šå¿«é©ãªéŸ³æ¥½è¦–è´ä½“é¨“ã‚’æä¾›ã™ã‚‹ã€‚

### ä¸»è¦æ©Ÿèƒ½

1. **é€£ç¶šå†ç”Ÿ** - æ¥½æ›²ãƒªã‚¹ãƒˆã‹ã‚‰è‡ªå‹•çš„ã«æ¬¡ã®æ›²ã‚’å†ç”Ÿ
2. **å†ç”Ÿã‚­ãƒ¥ãƒ¼** - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ç®¡ç†ã•ã‚Œã‚‹ä¸€æ™‚çš„ãªå†ç”Ÿé †åº
3. **ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ** - ã‚µãƒ¼ãƒãƒ¼å´ã«ä¿å­˜ã•ã‚Œã‚‹æ¥½æ›²ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

---

## ğŸ¯ æ©Ÿèƒ½è¦ä»¶

### 1. é€£ç¶šå†ç”Ÿæ©Ÿèƒ½

#### 1.1 åŸºæœ¬å‹•ä½œ

**æ¦‚è¦**  
ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²ãŒçµ‚äº†ã—ãŸã‚‰ã€è‡ªå‹•çš„ã«æ¬¡ã®æ¥½æ›²ã‚’å†ç”Ÿã™ã‚‹æ©Ÿèƒ½ã€‚

**ãƒˆã‚°ãƒ«è¨­å®š**
- ON/OFFåˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- è¨­å®šã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: OFF

**å†ç”Ÿé †åº**
- ç¾åœ¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ¥½æ›²ãƒªã‚¹ãƒˆã®é †åºã«å¾“ã†
- æ¤œç´¢çµæœãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå ´åˆã¯æ¤œç´¢çµæœå†…ã§é€£ç¶šå†ç”Ÿ
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè¡¨ç¤ºä¸­ã¯ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã§é€£ç¶šå†ç”Ÿ

**å‹•ä½œãƒ•ãƒ­ãƒ¼**
```
1. æ¥½æ›²Aå†ç”Ÿä¸­
2. æ¥½æ›²AãŒçµ‚äº†ï¼ˆend_timeã«åˆ°é”ï¼‰
3. é€£ç¶šå†ç”ŸãŒONã®å ´åˆ
   â”œâ”€ ãƒªã‚¹ãƒˆå†…ã®æ¬¡ã®æ¥½æ›²ã‚’æ¤œç´¢
   â”œâ”€ æ¬¡ã®æ¥½æ›²ãŒå­˜åœ¨ã™ã‚‹å ´åˆ â†’ è‡ªå‹•å†ç”Ÿ
   â””â”€ æ¬¡ã®æ¥½æ›²ãŒå­˜åœ¨ã—ãªã„å ´åˆ â†’ å†ç”Ÿåœæ­¢
4. é€£ç¶šå†ç”ŸãŒOFFã®å ´åˆ
   â””â”€ å†ç”Ÿåœæ­¢
```

#### 1.2 UIè¦ç´ 

**é€£ç¶šå†ç”Ÿãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³**
- ä½ç½®: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸‹éƒ¨
- è¡¨ç¤º:
  - ONæ™‚: ğŸ” é€£ç¶šå†ç”Ÿ ONï¼ˆç·‘è‰²ï¼‰
  - OFFæ™‚: ğŸ” é€£ç¶šå†ç”Ÿ OFFï¼ˆã‚°ãƒ¬ãƒ¼ï¼‰
- æ©Ÿèƒ½: ã‚¯ãƒªãƒƒã‚¯ã§ON/OFFåˆ‡ã‚Šæ›¿ãˆ

**å†ç”Ÿä¸­ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼**
- ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
- æ¬¡ã«å†ç”Ÿã•ã‚Œã‚‹æ¥½æ›²ã«ãƒãƒƒã‚¸è¡¨ç¤ºï¼ˆé€£ç¶šå†ç”ŸONæ™‚ï¼‰

#### 1.3 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

**UC-1: é€šå¸¸ãƒªã‚¹ãƒˆã§ã®é€£ç¶šå†ç”Ÿ**
```
å‰ææ¡ä»¶: æ¥½æ›²ãƒªã‚¹ãƒˆè¡¨ç¤ºä¸­ã€é€£ç¶šå†ç”ŸON
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¥½æ›²Aã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ å†ç”Ÿé–‹å§‹
2. æ¥½æ›²Açµ‚äº† â†’ ãƒªã‚¹ãƒˆå†…ã®æ¬¡ã®æ¥½æ›²BãŒè‡ªå‹•å†ç”Ÿ
3. æ¥½æ›²Bçµ‚äº† â†’ ãƒªã‚¹ãƒˆå†…ã®æ¬¡ã®æ¥½æ›²CãŒè‡ªå‹•å†ç”Ÿ
4. æœ€å¾Œã®æ¥½æ›²çµ‚äº† â†’ å†ç”Ÿåœæ­¢
```

**UC-2: æ¤œç´¢çµæœã§ã®é€£ç¶šå†ç”Ÿ**
```
å‰ææ¡ä»¶: æ¤œç´¢å®Ÿè¡Œæ¸ˆã¿ã€é€£ç¶šå†ç”ŸON
1. æ¤œç´¢çµæœã‹ã‚‰æ¥½æ›²Xã‚’ã‚¯ãƒªãƒƒã‚¯ â†’ å†ç”Ÿé–‹å§‹
2. æ¥½æ›²Xçµ‚äº† â†’ æ¤œç´¢çµæœå†…ã®æ¬¡ã®æ¥½æ›²YãŒè‡ªå‹•å†ç”Ÿ
3. ï¼ˆæ¤œç´¢çµæœã®ç¯„å›²å†…ã§ã®ã¿é€£ç¶šå†ç”Ÿï¼‰
```

---

### 2. å†ç”Ÿã‚­ãƒ¥ãƒ¼æ©Ÿèƒ½

#### 2.1 åŸºæœ¬å‹•ä½œ

**æ¦‚è¦**  
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ç®¡ç†ã•ã‚Œã‚‹ã€ä¸€æ™‚çš„ãªå†ç”Ÿé †åºãƒªã‚¹ãƒˆã€‚ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã§æ¶ˆå¤±ã™ã‚‹ã€‚

**ç‰¹å¾´**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³å˜ä½ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ãƒ¢ãƒªä¸Šï¼‰ã§ç®¡ç†
- ã‚µãƒ¼ãƒãƒ¼ã¸ã®ä¿å­˜ãªã—
- æ¥½æ›²ã®è¿½åŠ ãƒ»å‰Šé™¤ãƒ»ä¸¦ã³æ›¿ãˆãŒå¯èƒ½
- é€£ç¶šå†ç”Ÿæ©Ÿèƒ½ã¨é€£å‹•

**ãƒ‡ãƒ¼ã‚¿æ§‹é€ **
```typescript
interface PlayQueue {
  songs: Song[]           // å†ç”Ÿã‚­ãƒ¥ãƒ¼ã«å«ã¾ã‚Œã‚‹æ¥½æ›²
  currentIndex: number    // ç¾åœ¨å†ç”Ÿä¸­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
}
```

#### 2.2 UIè¦ç´ 

**å†ç”Ÿã‚­ãƒ¥ãƒ¼ãƒ‘ãƒãƒ«**
- ä½ç½®: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸‹éƒ¨ã¾ãŸã¯ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
- è¡¨ç¤ºå†…å®¹:
  - ã‚­ãƒ¥ãƒ¼å†…ã®æ¥½æ›²ãƒªã‚¹ãƒˆ
  - ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  - æ¬¡ã«å†ç”Ÿã•ã‚Œã‚‹æ¥½æ›²ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  - æ¥½æ›²æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆä¾‹: "å†ç”Ÿã‚­ãƒ¥ãƒ¼ 5æ›²"ï¼‰

**æ“ä½œãƒœã‚¿ãƒ³**
- ã€Œã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã€ãƒœã‚¿ãƒ³: å„æ¥½æ›²ã‚¢ã‚¤ãƒ†ãƒ ã«è¡¨ç¤º
- ã€Œã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³: ã™ã¹ã¦ã®æ¥½æ›²ã‚’å‰Šé™¤
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—: å†ç”Ÿé †åºã®å…¥ã‚Œæ›¿ãˆ
- å‰Šé™¤ãƒœã‚¿ãƒ³: å€‹åˆ¥ã®æ¥½æ›²ã‚’å‰Šé™¤

#### 2.3 æ“ä½œãƒ•ãƒ­ãƒ¼

**ã‚­ãƒ¥ãƒ¼ã¸ã®è¿½åŠ **
```
1. æ¥½æ›²ãƒªã‚¹ãƒˆã§æ¥½æ›²ã®ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å†ç”Ÿã‚­ãƒ¥ãƒ¼ã®æœ«å°¾ã«æ¥½æ›²ã‚’è¿½åŠ 
3. é€šçŸ¥è¡¨ç¤º: "ã€Œæ¥½æ›²åã€ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã—ã¾ã—ãŸ"
```

**ã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã®å†ç”Ÿ**
```
1. å†ç”Ÿã‚­ãƒ¥ãƒ¼ãƒ‘ãƒãƒ«ã‚’é–‹ã
2. ã‚­ãƒ¥ãƒ¼å†…ã®æ¥½æ›²ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãã®æ¥½æ›²ã‹ã‚‰å†ç”Ÿé–‹å§‹
4. é€£ç¶šå†ç”ŸONã®å ´åˆã€ã‚­ãƒ¥ãƒ¼å†…ã®æ¬¡ã®æ¥½æ›²ã¸è‡ªå‹•é·ç§»
```

**ä¸¦ã³æ›¿ãˆ**
```
1. ã‚­ãƒ¥ãƒ¼å†…ã®æ¥½æ›²ã‚’ãƒ‰ãƒ©ãƒƒã‚°
2. ç›®çš„ã®ä½ç½®ã«ãƒ‰ãƒ­ãƒƒãƒ—
3. å†ç”Ÿé †åºãŒæ›´æ–°ã•ã‚Œã‚‹
```

#### 2.4 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

**UC-3: ã‚«ã‚¹ã‚¿ãƒ å†ç”Ÿé †åºã®ä½œæˆ**
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¥½æ›²Aã€Cã€Bã®é †ã§ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. å†ç”Ÿã‚­ãƒ¥ãƒ¼ã« [A, C, B] ã®é †ã§è¿½åŠ ã•ã‚Œã‚‹
3. å†ç”Ÿé–‹å§‹ â†’ A â†’ C â†’ B ã®é †ã§å†ç”Ÿ
```

**UC-4: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãªã‚­ãƒ¥ãƒ¼ç·¨é›†**
```
1. å†ç”Ÿã‚­ãƒ¥ãƒ¼: [A, B, C, D]
2. ç¾åœ¨Bã‚’å†ç”Ÿä¸­
3. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCã‚’å‰Šé™¤ â†’ ã‚­ãƒ¥ãƒ¼: [A, B, D]
4. Bçµ‚äº†å¾Œã€DãŒå†ç”Ÿã•ã‚Œã‚‹
```

---

### 3. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆæ©Ÿèƒ½

#### 3.1 åŸºæœ¬å‹•ä½œ

**æ¦‚è¦**  
ã‚µãƒ¼ãƒãƒ¼å´ã«æ°¸ç¶šåŒ–ã•ã‚Œã‚‹æ¥½æ›²ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€‚ä½œæˆãƒ»ç·¨é›†ãƒ»å‰Šé™¤ãŒå¯èƒ½ã€‚

**ç‰¹å¾´**
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ï¼ˆ`playlists`ã€`playlist_songs`ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
- è¤‡æ•°ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆå¯èƒ½
- æ¥½æ›²ã®é †åºç®¡ç†ï¼ˆ`position`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼‰
- å†ç”Ÿã‚­ãƒ¥ãƒ¼ã¸ã®ä¸€æ‹¬è¿½åŠ ãŒå¯èƒ½

**æ—¢å­˜DBã‚¹ã‚­ãƒ¼ãƒï¼ˆå†ç¢ºèªï¼‰**
```sql
-- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ
CREATE TABLE playlists (
    id SERIAL PRIMARY KEY,
    public_id TEXT UNIQUE NOT NULL,
    name TEXT NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨æ¥½æ›²ã®é–¢é€£
CREATE TABLE playlist_songs (
    playlist_id INTEGER NOT NULL REFERENCES playlists(id) ON DELETE CASCADE,
    song_id INTEGER NOT NULL REFERENCES songs(id) ON DELETE CASCADE,
    position INTEGER NOT NULL,
    created_at TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (playlist_id, song_id),
    CONSTRAINT check_position_positive CHECK (position > 0),
    UNIQUE (playlist_id, position)
);
```

#### 3.2 UIè¦ç´ 

**ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§**
- ä½ç½®: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³å†…ã®ã‚¿ãƒ–
- è¡¨ç¤ºå†…å®¹:
  - ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå
  - æ¥½æ›²æ•°
  - ä½œæˆæ—¥æ™‚
  - ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆæœ€åˆã®æ¥½æ›²ã®ã‚µãƒ ãƒã‚¤ãƒ«ï¼‰

**ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°**
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåç·¨é›†
- æ¥½æ›²ãƒªã‚¹ãƒˆï¼ˆä¸¦ã³æ›¿ãˆå¯èƒ½ï¼‰
- æ“ä½œãƒœã‚¿ãƒ³:
  - ã€Œã™ã¹ã¦å†ç”Ÿã€: å…ˆé ­ã‹ã‚‰é€£ç¶šå†ç”Ÿ
  - ã€Œã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã€: ã™ã¹ã¦ã®æ¥½æ›²ã‚’å†ç”Ÿã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
  - ã€Œæ¥½æ›²ã‚’è¿½åŠ ã€: æ—¢å­˜æ¥½æ›²ã‹ã‚‰é¸æŠ
  - ã€Œå‰Šé™¤ã€: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’å‰Šé™¤

**æ–°è¦ä½œæˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°**
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåå…¥åŠ›
- ã€Œä½œæˆã€ãƒœã‚¿ãƒ³
- ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ãƒœã‚¿ãƒ³

**å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‹ã‚‰ã®ä½œæˆ**
- å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–ã«ã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’é…ç½®
- ã‚¯ãƒªãƒƒã‚¯ã§ç¾åœ¨ã®ã‚­ãƒ¥ãƒ¼å†…å®¹ã‚’ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ä¿å­˜å¾Œã‚‚ã‚­ãƒ¥ãƒ¼ã¯ã‚¯ãƒªã‚¢ã•ã‚Œãªã„ï¼ˆãã®ã¾ã¾å†ç”Ÿç¶™ç¶šå¯èƒ½ï¼‰

#### 3.3 æ“ä½œãƒ•ãƒ­ãƒ¼

**ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ä½œæˆ**
```
1. ã€Œæ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåã‚’å…¥åŠ›
3. ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. POST /api/playlists { name: "ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå" }
5. ç©ºã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒä½œæˆã•ã‚Œã‚‹
```

**æ¥½æ›²ã®è¿½åŠ **
```
1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°ç”»é¢ã§ã€Œæ¥½æ›²ã‚’è¿½åŠ ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. æ¥½æ›²é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤º
3. æ¥½æ›²ã‚’é¸æŠã—ã¦ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. POST /api/playlists/{playlistId}/songs { songId: "xxx" }
5. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«æ¥½æ›²ãŒè¿½åŠ ã•ã‚Œã‚‹
```

**æ¥½æ›²ã®ä¸¦ã³æ›¿ãˆ**
```
1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°ç”»é¢ã§æ¥½æ›²ã‚’ãƒ‰ãƒ©ãƒƒã‚°
2. ç›®çš„ã®ä½ç½®ã«ãƒ‰ãƒ­ãƒƒãƒ—
3. PUT /api/playlists/{playlistId}/songs/reorder
   { songIds: ["id1", "id2", "id3"] }
4. é †åºãŒæ›´æ–°ã•ã‚Œã‚‹
```

**ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰ã®å†ç”Ÿ**
```
1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°ç”»é¢ã§ã€Œã™ã¹ã¦å†ç”Ÿã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®æ¥½æ›²ãŒã™ã¹ã¦å†ç”Ÿã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹
3. å…ˆé ­ã®æ¥½æ›²ã‹ã‚‰è‡ªå‹•å†ç”Ÿé–‹å§‹
4. é€£ç¶šå†ç”ŸONã®å ´åˆã€é †æ¬¡å†ç”Ÿã•ã‚Œã‚‹
```

**å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ**
```
1. å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–ã§è¤‡æ•°ã®æ¥½æ›²ã‚’è¿½åŠ ãƒ»ä¸¦ã³æ›¿ãˆ
2. ã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåå…¥åŠ›ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒè¡¨ç¤º
4. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåã‚’å…¥åŠ›ã—ã¦ã€Œä½œæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
5. POST /api/playlists/from-queue
   {
     name: "ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå",
     songIds: ["id1", "id2", "id3"]
   }
6. ç¾åœ¨ã®ã‚­ãƒ¥ãƒ¼å†…å®¹ã§ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒä½œæˆã•ã‚Œã‚‹
7. é€šçŸ¥è¡¨ç¤º: "ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã€Œâ—‹â—‹ã€ã‚’ä½œæˆã—ã¾ã—ãŸ"
8. å†ç”Ÿã‚­ãƒ¥ãƒ¼ã¯ãã®ã¾ã¾ç¶­æŒã•ã‚Œã‚‹
```

#### 3.4 ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹

**UC-5: ãŠæ°—ã«å…¥ã‚Šãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ä½œæˆ**
```
1. ã€Œæ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. åå‰ã‚’ã€ŒãŠæ°—ã«å…¥ã‚Šã€ã¨å…¥åŠ›ã—ã¦ä½œæˆ
3. æ¥½æ›²ãƒªã‚¹ãƒˆã‹ã‚‰æ°—ã«å…¥ã£ãŸæ¥½æ›²ã‚’ã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«è¿½åŠ ã€
4. ã€ŒãŠæ°—ã«å…¥ã‚Šã€ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’é¸æŠ
5. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«æ¥½æ›²ãŒè¿½åŠ ã•ã‚Œã‚‹
```

**UC-6: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ä¸€æ‹¬å†ç”Ÿ**
```
1. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§ã‹ã‚‰ã€Œä½œæ¥­ç”¨BGMã€ã‚’é¸æŠ
2. ã€Œã™ã¹ã¦å†ç”Ÿã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã®æ¥½æ›²ãŒå†ç”Ÿã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã•ã‚Œã‚‹
4. é€£ç¶šå†ç”Ÿã§å…¨æ›²ãŒé †æ¬¡å†ç”Ÿã•ã‚Œã‚‹
```

**UC-7: å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ**
```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¥½æ›²ãƒªã‚¹ãƒˆã‹ã‚‰ãŠæ°—ã«å…¥ã‚Šã®æ¥½æ›²ã‚’é †æ¬¡ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
   ï¼ˆæ¥½æ›²A â†’ æ¥½æ›²D â†’ æ¥½æ›²B â†’ æ¥½æ›²F ã®é †ï¼‰
2. ã‚­ãƒ¥ãƒ¼å†…ã§ä¸¦ã³æ›¿ãˆã¦ç†æƒ³çš„ãªå†ç”Ÿé †åºã‚’ä½œæˆ
3. å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–ã§ã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
4. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåã€Œä»Šæ—¥ã®ãŠæ°—ã«å…¥ã‚Šã€ã¨å…¥åŠ›
5. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒä½œæˆã•ã‚Œã€ã‚­ãƒ¥ãƒ¼ã®å†…å®¹ãŒä¿å­˜ã•ã‚Œã‚‹
6. å†ç”Ÿã¯ç¶™ç¶šã•ã‚ŒãŸã¾ã¾ã€å¾Œæ—¥ã“ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰å†åº¦å†ç”Ÿå¯èƒ½
```

---

## ğŸ”Œ APIè¨­è¨ˆ

### ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆç®¡ç†API

#### GET /api/playlists
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§ã‚’å–å¾—

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlists": [
    {
      "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
      "name": "ãŠæ°—ã«å…¥ã‚Š",
      "songCount": 10,
      "createdAt": "2026-01-27T10:00:00Z",
      "updatedAt": "2026-01-27T15:30:00Z",
      "firstSongThumbnail": "https://i.ytimg.com/vi/xxxxx/default.jpg"
    }
  ]
}
```

#### POST /api/playlists
**æ¦‚è¦**: æ–°è¦ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "name": "æ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
  "name": "æ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ",
  "createdAt": "2026-01-27T10:00:00Z"
}
```

#### GET /api/playlists/{playlistId}
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°ã‚’å–å¾—ï¼ˆæ¥½æ›²ãƒªã‚¹ãƒˆå«ã‚€ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
  "name": "ãŠæ°—ã«å…¥ã‚Š",
  "songs": [
    {
      "position": 1,
      "songId": "01HQYYYYYYYYYYYYYYYYYYYYYY",
      "title": "æ¥½æ›²å",
      "artist": "ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå",
      "startAt": "PT0S",
      "endAt": "PT300S",
      "source": {
        "sourceId": "01HQZZZZZZZZZZZZZZZZZZZZZZ",
        "title": "å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«",
        "url": "https://www.youtube.com/watch?v=xxxxx",
        "sourceType": "VIDEO",
        "thumbnailUrl": "https://i.ytimg.com/vi/xxxxx/default.jpg"
      },
      "singers": [
        {
          "singerId": "01HQWWWWWWWWWWWWWWWWWWWWWW",
          "singerName": "æ­Œæ‰‹å"
        }
      ]
    }
  ],
  "createdAt": "2026-01-27T10:00:00Z",
  "updatedAt": "2026-01-27T15:30:00Z"
}
```

#### PUT /api/playlists/{playlistId}
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆåã‚’æ›´æ–°

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "name": "æ›´æ–°å¾Œã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
  "name": "æ›´æ–°å¾Œã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå",
  "updatedAt": "2026-01-27T16:00:00Z"
}
```

#### DELETE /api/playlists/{playlistId}
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’å‰Šé™¤

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "message": "Playlist deleted successfully"
}
```

#### POST /api/playlists/{playlistId}/songs
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«æ¥½æ›²ã‚’è¿½åŠ 

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "songId": "01HQYYYYYYYYYYYYYYYYYYYYYY"
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
  "songId": "01HQYYYYYYYYYYYYYYYYYYYYYY",
  "position": 11
}
```

#### DELETE /api/playlists/{playlistId}/songs/{songId}
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰æ¥½æ›²ã‚’å‰Šé™¤

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "message": "Song removed from playlist successfully"
}
```

#### PUT /api/playlists/{playlistId}/songs/reorder
**æ¦‚è¦**: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã®æ¥½æ›²é †åºã‚’å¤‰æ›´

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "songIds": [
    "01HQYYY1YYYYYYYYYYYYYYYYYYYY",
    "01HQYYY3YYYYYYYYYYYYYYYYYYYY",
    "01HQYYY2YYYYYYYYYYYYYYYYYYYY"
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "message": "Playlist reordered successfully",
  "updatedAt": "2026-01-27T16:30:00Z"
}
```

#### POST /api/playlists/from-queue
**æ¦‚è¦**: å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‹ã‚‰ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ

**ãƒªã‚¯ã‚¨ã‚¹ãƒˆ**
```json
{
  "name": "ä»Šæ—¥ã®ãŠæ°—ã«å…¥ã‚Š",
  "songIds": [
    "01HQYYY1YYYYYYYYYYYYYYYYYYYY",
    "01HQYYY2YYYYYYYYYYYYYYYYYYYY",
    "01HQYYY3YYYYYYYYYYYYYYYYYYYY"
  ]
}
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹**
```json
{
  "playlistId": "01HQXXXXXXXXXXXXXXXXXXXXXX",
  "name": "ä»Šæ—¥ã®ãŠæ°—ã«å…¥ã‚Š",
  "songCount": 3,
  "createdAt": "2026-01-27T17:00:00Z"
}
```

---

## ğŸ¨ UI/UXè¨­è¨ˆ

### ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VMusicPlayer                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                  â”‚  â”‚ æ¤œç´¢ãƒãƒ¼                      â”‚   â”‚
â”‚                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚   YouTubePlayer  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚                  â”‚  â”‚ ã‚¿ãƒ–: [ã™ã¹ã¦] [ã‚­ãƒ¥ãƒ¼]      â”‚   â”‚
â”‚   (40%)          â”‚  â”‚      [ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ]           â”‚   â”‚
â”‚                  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚                  â”‚  â”‚                               â”‚   â”‚
â”‚                  â”‚  â”‚  æ¥½æ›²ãƒªã‚¹ãƒˆ                   â”‚   â”‚
â”‚                  â”‚  â”‚  - æ¥½æ›²1 [+] [â™¥]             â”‚   â”‚
â”‚                  â”‚  â”‚  - æ¥½æ›²2 [+] [â™¥]             â”‚   â”‚
â”‚                  â”‚  â”‚  - æ¥½æ›²3 [+] [â™¥]             â”‚   â”‚
â”‚                  â”‚  â”‚                               â”‚   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                               â”‚   â”‚
â”‚ [ğŸ” é€£ç¶šå†ç”Ÿ ON] â”‚  â”‚                               â”‚   â”‚
â”‚ [ãƒªãƒ”ãƒ¼ãƒˆ OFF]   â”‚  â”‚                               â”‚   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”˜
      (40%)                      (60%)
```

### ã‚¿ãƒ–æ§‹æˆ

**1. ã™ã¹ã¦ã‚¿ãƒ–**
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ“ãƒ¥ãƒ¼
- å…¨æ¥½æ›²ã®ãƒªã‚¹ãƒˆè¡¨ç¤º
- æ¤œç´¢æ©Ÿèƒ½
- å„æ¥½æ›²ã«ã€Œã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã€ãƒœã‚¿ãƒ³

**2. ã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–**
- å†ç”Ÿã‚­ãƒ¥ãƒ¼ã®æ¥½æ›²ãƒªã‚¹ãƒˆ
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã§ä¸¦ã³æ›¿ãˆ
- ç¾åœ¨å†ç”Ÿä¸­ã®æ¥½æ›²ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
- ã€Œã‚­ãƒ¥ãƒ¼ã‚’ã‚¯ãƒªã‚¢ã€ãƒœã‚¿ãƒ³
- ã€Œãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¨ã—ã¦ä¿å­˜ã€ãƒœã‚¿ãƒ³

**3. ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚¿ãƒ–**
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§è¡¨ç¤º
- å„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°è¡¨ç¤º
- ã€Œæ–°ã—ã„ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã€ãƒœã‚¿ãƒ³

### ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³

**é€£ç¶šå†ç”Ÿãƒˆã‚°ãƒ«**
- ã‚¯ãƒªãƒƒã‚¯ã§ON/OFFåˆ‡ã‚Šæ›¿ãˆ
- çŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
- ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆè‰²å¤‰åŒ–ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

**å†ç”Ÿã‚­ãƒ¥ãƒ¼è¿½åŠ **
- ã€Œ+ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å³åº§ã«è¿½åŠ 
- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã§ç¢ºèªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–ã®ãƒãƒƒã‚¸ã«æ•°é‡è¡¨ç¤º

**ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—**
- æ¥½æ›²ã‚¢ã‚¤ãƒ†ãƒ ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½
- ãƒ‰ãƒ­ãƒƒãƒ—ä½ç½®ã«ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼è¡¨ç¤º
- ãƒ‰ãƒ­ãƒƒãƒ—å¾Œã«é †åºã‚’è‡ªå‹•ä¿å­˜

---

## ğŸ”§ æŠ€è¡“å®Ÿè£…

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNuxt.jsï¼‰

#### çŠ¶æ…‹ç®¡ç†

**é€£ç¶šå†ç”ŸçŠ¶æ…‹**
```typescript
// composables/usePlayback.ts
export const usePlayback = () => {
  const isContinuousPlay = useState<boolean>('continuousPlay', () => {
    if (process.client) {
      return localStorage.getItem('continuousPlay') === 'true'
    }
    return false
  })

  const toggleContinuousPlay = () => {
    isContinuousPlay.value = !isContinuousPlay.value
    if (process.client) {
      localStorage.setItem('continuousPlay', String(isContinuousPlay.value))
    }
  }

  return {
    isContinuousPlay,
    toggleContinuousPlay
  }
}
```

**å†ç”Ÿã‚­ãƒ¥ãƒ¼ç®¡ç†**
```typescript
// composables/usePlayQueue.ts
export const usePlayQueue = () => {
  const queue = useState<Song[]>('playQueue', () => [])
  const currentIndex = useState<number>('currentQueueIndex', () => -1)

  const addToQueue = (song: Song) => {
    queue.value.push(song)
  }

  const removeFromQueue = (index: number) => {
    queue.value.splice(index, 1)
    if (currentIndex.value >= index && currentIndex.value > 0) {
      currentIndex.value--
    }
  }

  const clearQueue = () => {
    queue.value = []
    currentIndex.value = -1
  }

  const reorderQueue = (fromIndex: number, toIndex: number) => {
    const item = queue.value.splice(fromIndex, 1)[0]
    queue.value.splice(toIndex, 0, item)
  }

  const playNext = () => {
    if (currentIndex.value < queue.value.length - 1) {
      currentIndex.value++
      return queue.value[currentIndex.value]
    }
    return null
  }

  const playPrevious = () => {
    if (currentIndex.value > 0) {
      currentIndex.value--
      return queue.value[currentIndex.value]
    }
    return null
  }

  return {
    queue: readonly(queue),
    currentIndex: readonly(currentIndex),
    addToQueue,
    removeFromQueue,
    clearQueue,
    reorderQueue,
    playNext,
    playPrevious
  }
}
```

#### YouTubePlayerä¿®æ­£

```typescript
// components/YouTubePlayer.vue ã«è¿½åŠ 
const emit = defineEmits<{
  ended: []  // æ¥½æ›²çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆ
}>()

// onStateChangeã‚¤ãƒ™ãƒ³ãƒˆå†…
onStateChange: (event: any) => {
  if (event.data === (window as any).YT.PlayerState.ENDED) {
    emit('ended')  // æ¥½æ›²çµ‚äº†ã‚’è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é€šçŸ¥
  }
}
```

#### SongListä¿®æ­£

```typescript
// components/SongList.vue ã«è¿½åŠ 
const { isContinuousPlay, toggleContinuousPlay } = usePlayback()
const { addToQueue } = usePlayQueue()

// æ¥½æ›²çµ‚äº†æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
const onSongEnded = () => {
  if (isContinuousPlay.value) {
    const currentSongIndex = displayedSongs.value.findIndex(
      s => s.songId === selectedSong.value?.songId
    )
    if (currentSongIndex >= 0 && currentSongIndex < displayedSongs.value.length - 1) {
      selectSong(displayedSongs.value[currentSongIndex + 1])
    }
  }
}

// ã‚­ãƒ¥ãƒ¼è¿½åŠ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
const addSongToQueue = (song: Song) => {
  addToQueue(song)
  // ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã‚’è¡¨ç¤º
  showToast(`ã€Œ${song.title}ã€ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã—ã¾ã—ãŸ`)
}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆSpring Boot + Kotlinï¼‰

#### Entity

```kotlin
// PlaylistEntity.kt
@Entity
@Table(name = "playlists")
data class PlaylistEntity(
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    val id: Long = 0,

    @Column(name = "public_id", unique = true, nullable = false)
    val publicId: String = Ulid.fast().toString(),

    @Column(nullable = false)
    var name: String,

    @Column(name = "created_at", nullable = false)
    val createdAt: LocalDateTime = LocalDateTime.now(),

    @Column(name = "updated_at", nullable = false)
    var updatedAt: LocalDateTime = LocalDateTime.now()
)

// PlaylistSongEntity.kt
@Entity
@Table(name = "playlist_songs")
@IdClass(PlaylistSongId::class)
data class PlaylistSongEntity(
    @Id
    @Column(name = "playlist_id")
    val playlistId: Long,

    @Id
    @Column(name = "song_id")
    val songId: Long,

    @Column(nullable = false)
    var position: Int,

    @Column(name = "created_at", nullable = false)
    val createdAt: LocalDateTime = LocalDateTime.now()
)

@Serializable
data class PlaylistSongId(
    val playlistId: Long = 0,
    val songId: Long = 0
) : Serializable
```

#### Repository

```kotlin
// PlaylistRepository.kt
interface PlaylistRepository : JpaRepository<PlaylistEntity, Long> {
    fun findByPublicId(publicId: String): PlaylistEntity?
}

// PlaylistSongRepository.kt
interface PlaylistSongRepository : JpaRepository<PlaylistSongEntity, PlaylistSongId> {
    fun findByPlaylistIdOrderByPositionAsc(playlistId: Long): List<PlaylistSongEntity>
    fun deleteByPlaylistIdAndSongId(playlistId: Long, songId: Long)
    fun countByPlaylistId(playlistId: Long): Long
}
```

#### Service

```kotlin
// PlaylistService.kt
@Service
class PlaylistService(
    private val playlistRepository: PlaylistRepository,
    private val playlistSongRepository: PlaylistSongRepository,
    private val songRepository: SongRepository
) {
    fun getAllPlaylists(): List<PlaylistResponse> {
        return playlistRepository.findAll().map { toResponse(it) }
    }

    fun getPlaylistById(publicId: String): PlaylistDetailResponse {
        val playlist = playlistRepository.findByPublicId(publicId)
            ?: throw NotFoundException("Playlist not found")
        
        val playlistSongs = playlistSongRepository
            .findByPlaylistIdOrderByPositionAsc(playlist.id)
        
        val songs = playlistSongs.map { ps ->
            val song = songRepository.findById(ps.songId).orElseThrow()
            PlaylistSongResponse(
                position = ps.position,
                song = songToResponse(song)
            )
        }
        
        return PlaylistDetailResponse(
            playlistId = playlist.publicId,
            name = playlist.name,
            songs = songs,
            createdAt = playlist.createdAt,
            updatedAt = playlist.updatedAt
        )
    }

    fun createPlaylist(request: CreatePlaylistRequest): PlaylistResponse {
        val playlist = PlaylistEntity(name = request.name)
        val saved = playlistRepository.save(playlist)
        return toResponse(saved)
    }

    fun addSongToPlaylist(playlistPublicId: String, songPublicId: String) {
        val playlist = playlistRepository.findByPublicId(playlistPublicId)
            ?: throw NotFoundException("Playlist not found")
        val song = songRepository.findByPublicId(songPublicId)
            ?: throw NotFoundException("Song not found")
        
        val maxPosition = playlistSongRepository
            .findByPlaylistIdOrderByPositionAsc(playlist.id)
            .maxOfOrNull { it.position } ?: 0
        
        val playlistSong = PlaylistSongEntity(
            playlistId = playlist.id,
            songId = song.id,
            position = maxPosition + 1
        )
        
        playlistSongRepository.save(playlistSong)
    }

    fun removeSongFromPlaylist(playlistPublicId: String, songPublicId: String) {
        val playlist = playlistRepository.findByPublicId(playlistPublicId)
            ?: throw NotFoundException("Playlist not found")
        val song = songRepository.findByPublicId(songPublicId)
            ?: throw NotFoundException("Song not found")
        
        playlistSongRepository.deleteByPlaylistIdAndSongId(playlist.id, song.id)
        
        // position ã‚’å†è¨ˆç®—
        reorderPositions(playlist.id)
    }

    fun reorderPlaylist(playlistPublicId: String, songIds: List<String>) {
        val playlist = playlistRepository.findByPublicId(playlistPublicId)
            ?: throw NotFoundException("Playlist not found")
        
        songIds.forEachIndexed { index, songPublicId ->
            val song = songRepository.findByPublicId(songPublicId)
                ?: throw NotFoundException("Song not found: $songPublicId")
            
            val playlistSong = playlistSongRepository
                .findById(PlaylistSongId(playlist.id, song.id))
                .orElseThrow()
            
            playlistSong.position = index + 1
            playlistSongRepository.save(playlistSong)
        }
        
        playlist.updatedAt = LocalDateTime.now()
        playlistRepository.save(playlist)
    }

    fun createPlaylistFromQueue(request: CreatePlaylistFromQueueRequest): PlaylistResponse {
        // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ä½œæˆ
        val playlist = PlaylistEntity(name = request.name)
        val saved = playlistRepository.save(playlist)
        
        // æ¥½æ›²ã‚’ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã«è¿½åŠ 
        request.songIds.forEachIndexed { index, songPublicId ->
            val song = songRepository.findByPublicId(songPublicId)
                ?: throw NotFoundException("Song not found: $songPublicId")
            
            val playlistSong = PlaylistSongEntity(
                playlistId = saved.id,
                songId = song.id,
                position = index + 1
            )
            playlistSongRepository.save(playlistSong)
        }
        
        return toResponse(saved, request.songIds.size)
    }

    private fun reorderPositions(playlistId: Long) {
        val songs = playlistSongRepository
            .findByPlaylistIdOrderByPositionAsc(playlistId)
        
        songs.forEachIndexed { index, song ->
            song.position = index + 1
            playlistSongRepository.save(song)
        }
    }
}
```

#### Controller

```kotlin
// PlaylistController.kt
@RestController
@RequestMapping("/api/playlists")
class PlaylistController(private val playlistService: PlaylistService) {

    @GetMapping
    fun getAllPlaylists(): List<PlaylistResponse> {
        return playlistService.getAllPlaylists()
    }

    @GetMapping("/{playlistId}")
    fun getPlaylist(@PathVariable playlistId: String): PlaylistDetailResponse {
        return playlistService.getPlaylistById(playlistId)
    }

    @PostMapping
    fun createPlaylist(@RequestBody request: CreatePlaylistRequest): PlaylistResponse {
        return playlistService.createPlaylist(request)
    }

    @PutMapping("/{playlistId}")
    fun updatePlaylist(
        @PathVariable playlistId: String,
        @RequestBody request: UpdatePlaylistRequest
    ): PlaylistResponse {
        return playlistService.updatePlaylist(playlistId, request)
    }

    @DeleteMapping("/{playlistId}")
    fun deletePlaylist(@PathVariable playlistId: String) {
        playlistService.deletePlaylist(playlistId)
    }

    @PostMapping("/{playlistId}/songs")
    fun addSongToPlaylist(
        @PathVariable playlistId: String,
        @RequestBody request: AddSongToPlaylistRequest
    ) {
        playlistService.addSongToPlaylist(playlistId, request.songId)
    }

    @DeleteMapping("/{playlistId}/songs/{songId}")
    fun removeSongFromPlaylist(
        @PathVariable playlistId: String,
        @PathVariable songId: String
    ) {
        playlistService.removeSongFromPlaylist(playlistId, songId)
    }

    @PutMapping("/{playlistId}/songs/reorder")
    fun reorderPlaylist(
        @PathVariable playlistId: String,
        @RequestBody request: ReorderPlaylistRequest
    ) {
        playlistService.reorderPlaylist(playlistId, request.songIds)
    }

    @PostMapping("/from-queue")
    fun createPlaylistFromQueue(
        @RequestBody request: CreatePlaylistFromQueueRequest
    ): PlaylistResponse {
        return playlistService.createPlaylistFromQueue(request)
    }
}
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### é€£ç¶šå†ç”Ÿãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant SongList
    participant YouTubePlayer
    participant Playback

    User->>SongList: æ¥½æ›²Aã‚’ã‚¯ãƒªãƒƒã‚¯
    SongList->>YouTubePlayer: æ¥½æ›²Aå†ç”Ÿé–‹å§‹
    YouTubePlayer->>YouTubePlayer: å†ç”Ÿä¸­...
    YouTubePlayer->>YouTubePlayer: çµ‚äº†æ¤œçŸ¥
    YouTubePlayer->>SongList: ended ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«
    SongList->>Playback: é€£ç¶šå†ç”ŸON?
    Playback-->>SongList: ã¯ã„
    SongList->>SongList: æ¬¡ã®æ¥½æ›²Bã‚’å–å¾—
    SongList->>YouTubePlayer: æ¥½æ›²Bå†ç”Ÿé–‹å§‹
```

### ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant User
    participant PlaylistView
    participant PlayQueue
    participant SongList
    participant API

    User->>PlaylistView: ã€Œã™ã¹ã¦å†ç”Ÿã€ã‚’ã‚¯ãƒªãƒƒã‚¯
    PlaylistView->>API: GET /api/playlists/{id}
    API-->>PlaylistView: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°
    PlaylistView->>PlayQueue: å…¨æ¥½æ›²ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ 
    PlayQueue->>SongList: å…ˆé ­æ¥½æ›²ã‚’å†ç”Ÿ
    SongList->>SongList: é€£ç¶šå†ç”Ÿã§é †æ¬¡å†ç”Ÿ
```

---

## âœ… å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: é€£ç¶šå†ç”Ÿæ©Ÿèƒ½ï¼ˆåŸºæœ¬ï¼‰

- [ ] YouTubePlayerã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«`ended`ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
- [ ] `usePlayback` composableã®å®Ÿè£…
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¸ã®çŠ¶æ…‹ä¿å­˜
- [ ] é€£ç¶šå†ç”Ÿãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³UIå®Ÿè£…
- [ ] SongListã§ã®æ¬¡ã®æ¥½æ›²è‡ªå‹•å†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯
- [ ] ç¾åœ¨å†ç”Ÿä¸­æ¥½æ›²ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º

### Phase 2: å†ç”Ÿã‚­ãƒ¥ãƒ¼æ©Ÿèƒ½

- [ ] `usePlayQueue` composableã®å®Ÿè£…
- [ ] å†ç”Ÿã‚­ãƒ¥ãƒ¼ã‚¿ãƒ–UIå®Ÿè£…
- [ ] ã€Œã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã€ãƒœã‚¿ãƒ³ã®å®Ÿè£…
- [ ] ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ã‚­ãƒ¥ãƒ¼ã‚¯ãƒªã‚¢æ©Ÿèƒ½
- [ ] ã‚­ãƒ¥ãƒ¼å†…æ¥½æ›²å‰Šé™¤æ©Ÿèƒ½
- [ ] ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã®å®Ÿè£…

### Phase 3: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆAPIï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

- [ ] PlaylistEntityã€PlaylistSongEntityå®Ÿè£…
- [ ] PlaylistRepositoryã€PlaylistSongRepositoryå®Ÿè£…
- [ ] PlaylistServiceå®Ÿè£…
- [ ] PlaylistControllerå®Ÿè£…
- [ ] APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ

### Phase 4: ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆUIï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä¸€è¦§ç”»é¢ã®å®Ÿè£…
- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆè©³ç´°ç”»é¢ã®å®Ÿè£…
- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®å®Ÿè£…
- [ ] æ¥½æ›²è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å®Ÿè£…
- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…æ¥½æ›²ã®ä¸¦ã³æ›¿ãˆæ©Ÿèƒ½
- [ ] ã€Œã™ã¹ã¦å†ç”Ÿã€æ©Ÿèƒ½ã®å®Ÿè£…
- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå‰Šé™¤æ©Ÿèƒ½

### Phase 5: çµ±åˆãƒ†ã‚¹ãƒˆ

- [ ] é€£ç¶šå†ç”Ÿ + é€šå¸¸ãƒªã‚¹ãƒˆ
- [ ] é€£ç¶šå†ç”Ÿ + æ¤œç´¢çµæœ
- [ ] é€£ç¶šå†ç”Ÿ + å†ç”Ÿã‚­ãƒ¥ãƒ¼
- [ ] é€£ç¶šå†ç”Ÿ + ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ
- [ ] ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‹ã‚‰ã‚­ãƒ¥ãƒ¼ã¸ã®è¿½åŠ 
- [ ] å„ç¨®ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ï¼ˆæœ€å¾Œã®æ›²ã€ç©ºã®ã‚­ãƒ¥ãƒ¼ç­‰ï¼‰

---

## ğŸ¯ ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

### ãƒªãƒ”ãƒ¼ãƒˆæ©Ÿèƒ½
- 1æ›²ãƒªãƒ”ãƒ¼ãƒˆ
- å…¨æ›²ãƒªãƒ”ãƒ¼ãƒˆ
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãƒªãƒ”ãƒ¼ãƒˆ

### ã‚·ãƒ£ãƒƒãƒ•ãƒ«å†ç”Ÿ
- ã‚­ãƒ¥ãƒ¼å†…ã§ãƒ©ãƒ³ãƒ€ãƒ å†ç”Ÿ
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚·ãƒ£ãƒƒãƒ•ãƒ«

### ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå…±æœ‰
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®å…¬é–‹/éå…¬é–‹è¨­å®š
- å…±æœ‰URLç”Ÿæˆ
- ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼

### ã‚¹ãƒãƒ¼ãƒˆå†ç”Ÿ
- æœ€è¿‘å†ç”Ÿã—ãŸæ¥½æ›²
- ã‚ˆãèãæ¥½æ›²ã®è‡ªå‹•ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ
- æ­Œæ‰‹åˆ¥ã®è‡ªå‹•ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ

### ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- JSONå½¢å¼ã§ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- å¤–éƒ¨ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

---

## ğŸ“ æ³¨æ„äº‹é …

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†…ã®æ¥½æ›²æ•°ãŒå¤šã„å ´åˆã®ä»®æƒ³ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œ
- å¤§é‡ã®æ¥½æ›²ã‚’å†ç”Ÿã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã™ã‚‹éš›ã®ãƒãƒƒãƒå‡¦ç†

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- YouTube APIã®ã‚¨ãƒ©ãƒ¼ï¼ˆå‹•ç”»å‰Šé™¤ã€å†ç”Ÿä¸å¯ç­‰ï¼‰
- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼æ™‚ã®å†è©¦è¡Œå‡¦ç†
- æ¥½æ›²ãƒ‡ãƒ¼ã‚¿ã®ä¸æ•´åˆãƒã‚§ãƒƒã‚¯

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã®æ‰€æœ‰æ¨©æ¤œè¨¼ï¼ˆå°†æ¥çš„ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãŒè¿½åŠ ã•ã‚Œã‚‹å ´åˆï¼‰
- SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ï¼ˆJPAä½¿ç”¨ã«ã‚ˆã‚ŠåŸºæœ¬çš„ã«å¯¾ç­–æ¸ˆã¿ï¼‰

### UX
- é•·æ™‚é–“å†ç”Ÿæ™‚ã®ãƒ¡ãƒ¢ãƒªç®¡ç†
- ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰æ™‚ã®å†ç”ŸçŠ¶æ…‹å¾©å…ƒæ¤œè¨
- ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œï¼ˆã‚¿ãƒƒãƒæ“ä½œã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ï¼‰

---

## ğŸ“š å‚è€ƒè³‡æ–™

### YouTube IFrame Player API
- https://developers.google.com/youtube/iframe_api_reference

### Nuxt.js State Management
- https://nuxt.com/docs/getting-started/state-management

### Spring Data JPA
- https://spring.io/projects/spring-data-jpa

---

**æ‰¿èª**: [ ]  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‹…å½“**: [ ]  
**å®Ÿè£…é–‹å§‹äºˆå®šæ—¥**: 2026-01-27

